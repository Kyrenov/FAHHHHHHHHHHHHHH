<!DOCTYPE html>
<html>
<head>
    <title>Avaris Menu</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: none;
            margin: 0;
            padding: 0;
            user-select: none;
            color: #fff;
        }
        .menu-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            background: rgba(30, 30, 30, 0.9);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .menu-header {
            background: #6200ea;
            padding: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            border-bottom: 2px solid #bb86fc;
        }
        .tabs {
            display: flex;
            background: rgba(50, 50, 50, 0.8);
            padding: 5px;
        }
        .tab {
            flex: 1;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease, color 0.2s ease;
        }
        .tab:hover {
            background: #bb86fc;
            color: #fff;
        }
        .tab.active {
            background: #6200ea;
            color: #fff;
            font-weight: bold;
        }
        .tab-content {
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #bb86fc rgba(0, 0, 0, 0.3);
        }
        .tab-content::-webkit-scrollbar {
            width: 8px;
        }
        .tab-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }
        .tab-content::-webkit-scrollbar-thumb {
            background: #bb86fc;
            border-radius: 4px;
        }
        .item {
            padding: 8px;
            margin: 5px 0;
            background: rgba(50, 50, 50, 0.8);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .item:hover {
            background: #bb86fc;
            transform: translateX(5px);
        }
        .item.selected {
            background: #6200ea;
            color: #fff;
        }
        .item input {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 14px;
        }
        .item input:focus {
            outline: none;
            box-shadow: 0 0 5px #bb86fc;
        }
        .item .state {
            font-size: 12px;
            color: #03dac6;
        }
        .item .state.off {
            color: #cf6679;
        }
    </style>
</head>
<body>
    <div class="menu-container" id="menu" style="display: none;">
        <div class="menu-header">Avaris Menu</div>
        <div class="tabs" id="tabs"></div>
        <div class="tab-content" id="tab-content"></div>
    </div>

    <script>
        let state = { activeTab: 0, selection: { index: 0 }, tabs: [] };

        function renderMenu(newState) {
            state = newState;
            const menu = document.getElementById('menu');
            const tabs = document.getElementById('tabs');
            const content = document.getElementById('tab-content');

            menu.style.display = 'block';
            tabs.innerHTML = '';
            content.innerHTML = '';

            state.tabs.forEach((tab, index) => {
                const tabEl = document.createElement('div');
                tabEl.className = `tab ${index === state.activeTab ? 'active' : ''}`;
                tabEl.textContent = tab.title;
                tabEl.onclick = () => {
                    window.sendMessageToLua({ action: 'changeTab', tabIndex: index });
                };
                tabs.appendChild(tabEl);
            });

            const activeTab = state.tabs[state.activeTab];
            if (activeTab && activeTab.items) {
                activeTab.items.forEach((item, index) => {
                    const itemEl = document.createElement('div');
                    itemEl.className = `item ${index === state.selection.index ? 'selected' : ''}`;
                    if (item.type === 'input') {
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = item.value || '';
                        input.placeholder = item.placeholder || '';
                        input.oninput = (e) => {
                            window.sendMessageToLua({ action: 'updateInput', tabIndex: state.activeTab, itemIndex: index, value: e.target.value });
                        };
                        itemEl.appendChild(input);
                    } else {
                        itemEl.textContent = item.label;
                        if (item.state) {
                            const stateEl = document.createElement('span');
                            stateEl.className = `state ${item.state.toLowerCase()}`;
                            stateEl.textContent = item.state.toUpperCase();
                            itemEl.appendChild(stateEl);
                        }
                        itemEl.onclick = () => {
                            window.sendMessageToLua({ action: 'selectItem', tabIndex: state.activeTab, itemIndex: index });
                        };
                    }
                    content.appendChild(itemEl);
                });
            }
        }

        function updateLogs(logState) {
            const logsTab = state.tabs.find(tab => tab.key === 'check_logs');
            if (logsTab) {
                logsTab.items = [{ type: 'button', label: 'Scan For Log Resources', action: 'scanForLogs' }];
                if (logState.stoppedLogs.length > 0) {
                    logsTab.items.push({ type: 'text', label: `Stopped Logs: ${logState.stoppedLogs.join(', ')}` });
                }
                if (logState.foundLogs.length > 0) {
                    logsTab.items.push({ type: 'text', label: `Found Logs: ${logState.foundLogs.join(', ')}` });
                }
                if (state.activeTab === state.tabs.findIndex(tab => tab.key === 'check_logs')) {
                    renderMenu(state);
                }
            }
        }

        window.addEventListener('message', (event) => {
            const data = event.data;
            if (data.action === 'update') {
                renderMenu(data.data);
            } else if (data.action === 'update_logs') {
                updateLogs(data.data);
            } else if (data.action === 'hide') {
                document.getElementById('menu').style.display = 'none';
            }
        });

        window.sendMessageToLua = function(message) {
            // Simulate sending message to Lua (replace with actual implementation)
            console.log('Sending to Lua:', message);
            // Example: Send message to game environment
            // window.parent.postMessage(message, '*');
        };
    </script>
</body>
</html>
